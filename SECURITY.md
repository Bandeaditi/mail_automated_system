# Security Considerations

This document outlines security measures, best practices, and potential risks for the Email Automation System.

## üîê Credential Management

### Gmail Credentials

**CRITICAL: Never share or commit credentials**

1. **Use App Passwords, Not Main Password**
   - App passwords are 16-character codes generated by Google
   - They can be revoked without changing your main password
   - They have limited scope (just email access)

2. **Environment Variable Storage**
   - Credentials stored in `.env` file (not in code)
   - `.env` is gitignored (never committed to version control)
   - File permissions should be restrictive:
     ```bash
     chmod 600 .env
     ```

3. **Password Rotation**
   - Rotate app passwords every 90 days
   - Revoke old passwords immediately after rotating
   - Keep audit log of password changes

### LLM Access

**Local LLM = Better Privacy**

- Ollama runs locally on your machine
- Email content never sent to cloud services
- You control the model and its data
- No API keys or tokens needed

## üõ°Ô∏è Email Security

### Sending Safety

1. **Human-in-the-Loop**
   - EVERY email requires explicit approval
   - No automated sending without user confirmation
   - User can edit or reject drafts

2. **Recipient Validation**
   - Email address format validation
   - No-reply address detection
   - Warning for suspicious addresses

3. **Rate Limiting**
   ```python
   min_send_interval = 2.0  # seconds
   ```
   - Prevents accidental email floods
   - Protects against bugs causing spam
   - Respects SMTP provider limits

4. **Dry-Run Mode**
   - Test without sending real emails
   - All operations logged but no sends
   - Essential for testing configuration changes

### Content Safety

1. **LLM Output Review**
   - Always review generated content before sending
   - LLM can make mistakes or generate inappropriate content
   - Human judgment is the final safety check

2. **Email Warnings**
   - System flags potential issues:
     - No-reply addresses
     - Very short emails
     - Missing context
   - Warnings shown during review

3. **Threading Preservation**
   - In-Reply-To headers maintained
   - References header preserved
   - Ensures proper conversation threading

## üîç Privacy Considerations

### Data Handling

1. **Local Processing**
   - All email processing happens on your machine
   - No data sent to external services (except Gmail IMAP/SMTP)
   - LLM runs locally via Ollama

2. **No Persistent Storage**
   - Emails are fetched, processed, and discarded
   - No database or permanent storage
   - Only logs are kept (which can be disabled)

3. **Logging**
   - Logs contain email subjects and sender addresses
   - Logs do NOT contain email bodies or passwords
   - Log level can be reduced: `LOG_LEVEL=ERROR` in .env

### LLM Privacy

**What the LLM sees:**
- Email subject
- Email body
- Sender and recipient addresses
- Date

**What the LLM doesn't see:**
- Your Gmail password
- Other emails in your inbox
- Your browsing history
- Any data outside this program

**Data retention:**
- Ollama does not retain prompts by default
- Each query is independent
- No training on your data

## ‚ö° Rate Limiting and Quotas

### Gmail Limits

**IMAP:**
- 2,500 requests per day (generous for typical use)
- 25 simultaneous connections
- 500 MB/sec bandwidth

**SMTP:**
- 500 emails per day (free Gmail)
- 2,000 emails per day (Google Workspace)
- 100 recipients per message

### System Limits

```python
# In email_sender.py
min_send_interval = 2.0  # Minimum 2 seconds between sends
```

**Why rate limit locally?**
- Prevents bugs from causing spam
- Respects Gmail quotas
- Gives user time to cancel if needed
- Reduces risk of account suspension

### Recommended Usage

- Fetch emails: 10-50 at a time
- Send replies: Review each one individually
- Batch sending: Max 20-30 per session
- If hitting limits: Spread operations across days

## üö® Risk Mitigation

### Potential Risks

1. **Accidental Email Sending**
   - **Mitigation**: Explicit approval required for each email
   - **Mitigation**: Dry-run mode for testing
   - **Mitigation**: Rate limiting prevents floods

2. **LLM Generating Inappropriate Content**
   - **Mitigation**: Human review before sending
   - **Mitigation**: Warnings displayed during review
   - **Mitigation**: Draft can be edited or rejected

3. **Credential Exposure**
   - **Mitigation**: Use app passwords (not main password)
   - **Mitigation**: Store in .env (never in code)
   - **Mitigation**: .env in .gitignore
   - **Mitigation**: File permissions (chmod 600)

4. **Unauthorized Access to System**
   - **Mitigation**: File permissions on .env
   - **Mitigation**: No remote access enabled by default
   - **Mitigation**: Logs track all operations

5. **Email Account Suspension**
   - **Mitigation**: Rate limiting
   - **Mitigation**: Proper email formatting
   - **Mitigation**: Threading preservation
   - **Mitigation**: Human approval prevents spam

### Security Incident Response

**If credentials are compromised:**

1. Immediately revoke the app password:
   - Go to [Google Account Security](https://myaccount.google.com/security)
   - Find "App passwords"
   - Revoke the compromised password

2. Generate a new app password

3. Update .env with new password

4. Review account activity:
   - Check sent emails for unauthorized sends
   - Review IMAP/SMTP access logs in Gmail

5. Consider enabling additional 2FA methods

**If LLM generates inappropriate content:**

1. Do NOT send the email
2. Review LLM prompt in `config/prompts.py`
3. Consider adjusting prompt instructions
4. Report issue if using hosted LLM service

## üîí Best Practices

### Development

1. **Never commit .env file**
   ```bash
   # Double-check before committing
   git status
   ```

2. **Use separate test account**
   - Don't test on primary email account
   - Create dedicated test Gmail account
   - Test all features in --dry-run first

3. **Review code changes**
   - Be especially careful with email_sender.py
   - Ensure approval checks remain in place
   - Test rate limiting after changes

### Production Use

1. **Start conservative**
   - Begin with dry-run mode
   - Send test emails to yourself
   - Gradually increase usage

2. **Monitor logs**
   ```bash
   # Watch logs in real-time
   tail -f logs/email_automation.log
   ```

3. **Regular security review**
   - Rotate app passwords quarterly
   - Review authorized applications monthly
   - Check Gmail security alerts

4. **Backup configuration**
   ```bash
   # Backup .env (encrypted)
   cp .env .env.backup
   # Encrypt the backup
   gpg -c .env.backup
   # Delete unencrypted backup
   rm .env.backup
   ```

### User Safeguards

1. **Read before approving**
   - Review EVERY draft before sending
   - Check recipient address
   - Verify tone and content

2. **Use context wisely**
   - Don't include sensitive info in context
   - Context is sent to LLM with every request
   - Keep context general and professional

3. **Limit scope**
   - Only fetch emails you want to process
   - Use filters if possible
   - Don't process entire inbox at once

## üî¨ Audit Trail

### Logging

**What is logged:**
- Email fetch operations (count, folder)
- Analysis results (importance, action)
- Reply generation (success/failure)
- Email sends (recipient, subject, status)
- LLM calls (duration, success)
- Errors and warnings

**What is NOT logged:**
- Email body content
- Passwords or credentials
- LLM prompt/response text (unless debug mode)

**Log format:**
```
[2024-01-15 10:30:45] [INFO] [email_sender] EMAIL SENT | Subject: 'Re: Meeting' | From: user@example.com | Reply sent successfully
```

### Recommendations

1. **Retain logs for auditing**
   - Keep logs for 30-90 days
   - Review logs weekly for anomalies
   - Archive old logs

2. **Monitor for suspicious activity**
   - Unusual number of sends
   - Sends to unexpected recipients
   - Failed authentication attempts

## üìã Compliance Considerations

### GDPR / Privacy Regulations

If you're in EU or processing EU resident data:

1. **Data Minimization**
   - Only fetch emails you need to process
   - Don't store emails permanently
   - Process and discard

2. **Purpose Limitation**
   - Only use emails for intended purpose (email management)
   - Don't use for marketing, training, etc.
   - Clear purpose statement in documentation

3. **User Control**
   - User has full control over what's sent
   - No automated decisions without human approval
   - User can edit or reject LLM output

### CAN-SPAM Act (US)

If sending marketing emails:

1. **Accurate Headers**
   - System preserves accurate sender information
   - No header manipulation or spoofing

2. **Clear Sender**
   - Emails sent from your account
   - Your address visible to recipients

3. **Opt-Out**
   - If doing marketing, include unsubscribe link
   - System doesn't automatically add these

## ‚öñÔ∏è Legal Disclaimer

**Important:**

- This system sends REAL emails
- You are responsible for content sent
- Review all drafts before sending
- Comply with all applicable laws
- System provides tools, not legal advice
- No warranty or liability for misuse

---

## üìû Security Questions?

If you discover a security issue:

1. Do NOT open a public issue
2. Review this document for mitigations
3. Consider if it affects your use case
4. Implement additional safeguards if needed

**Remember**: Security is a shared responsibility. This system provides tools and safeguards, but you must use them responsibly.
